# 微信支付配置说明

## 1. 配置文件

在 `appsettings.json` 中配置微信支付相关参数：

```json
{
  "WeChatPay": {
    "AppId": "你的小程序AppID",
    "MchId": "你的商户号",
    "MchSerialNo": "你的商户证书序列号",
    "MchPrivateKeyPemPath": "certs/apiclient_key.pem",
    "ApiV3Key": "你的APIv3密钥",
    "NotifyUrl": "https://your-domain.com/api/orders/pay/notify"
  }
}
```

## 2. 证书文件

将微信支付商户私钥文件 `apiclient_key.pem` 放置在项目根目录的 `certs` 文件夹中。

如果没有 `certs` 文件夹，请创建它。

## 3. 回调URL配置

在微信支付商户平台配置支付回调URL：
- 登录微信支付商户平台
- 进入"开发配置" -> "支付配置"
- 设置支付回调URL为：`http://txgapi.zzlol.cn/api/Orders/pay/notify`

## 4. API接口说明

### 创建支付订单
- **接口**: `POST /api/orders/{orderId}/pay`
- **请求体**:
```json
{
  "openId": "用户的openid"
}
```
- **响应**: 返回小程序调起支付所需的参数

### 支付回调
- **接口**: `POST /api/orders/pay/notify`
- **说明**: 微信支付成功后会自动调用此接口

### 获取OpenId
- **接口**: `POST /api/auth/getOpenId`
- **请求体**:
```json
{
  "code": "wx.login()获取的code"
}
```

## 5. 注意事项

1. 确保 `certs/apiclient_key.pem` 文件存在且路径正确
2. 回调URL必须是公网可访问的HTTPS地址
3. 生产环境需要配置正确的域名和SSL证书
4. 支付回调需要验证签名（当前为简化处理，生产环境需要完善）

